<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestione Furgoni - Admin</title>
  <link rel="stylesheet" href="/css/clean-theme.css">
</head>
<body>
  <!-- Overlay per chiudere sidebar su mobile -->
  <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

  <div class="app-container">
    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <a href="/admin/dashboard" class="sidebar-logo">Gestionale Consegne</a>
      </div>
      <ul class="sidebar-menu">
        <li><a href="/admin/dashboard">Dashboard</a></li>
        <li><a href="/admin/vehicles" class="active">Gestione Furgoni</a></li>
        <li><a href="/admin/dipendenti">Gestione Dipendenti</a></li>
        <li><a href="/admin/assignments">Assegnamenti</a></li>
        <li><a href="/admin/maintenance">Manutenzioni</a></li>
        <li><a href="/auth/logout">Logout</a></li>
      </ul>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main-content">
      <!-- TOPBAR -->
      <div class="topbar">
        <div class="breadcrumb">
          <button class="mobile-menu-btn" onclick="toggleSidebar()">â˜°</button>
          <span>Gestione Furgoni</span>
        </div>
        <div class="topbar-right">
          <div class="user-info">
            <span><%= user.nome %> <%= user.cognome %></span>
          </div>
          <a href="/auth/logout" class="btn btn-secondary btn-sm">Logout</a>
        </div>
      </div>

      <div class="container">
        <h2>Gestione Furgoni</h2>

        <% if (success && success.length > 0) { %>
          <div class="alert alert-success">
            <%= success[0] %>
          </div>
        <% } %>

        <% if (error && error.length > 0) { %>
          <div class="alert alert-error">
            <%= error[0] %>
          </div>
        <% } %>

        <!-- Form Aggiungi Nuovo Furgone -->
        <div class="card">
          <h3>Aggiungi Nuovo Furgone</h3>
          <form action="/admin/vehicles/create" method="POST">
            <div class="form-row">
              <div class="form-group">
                <label for="targa">Targa *</label>
                <input 
                  type="text" 
                  id="targa" 
                  name="targa" 
                  required 
                  placeholder="ES: AB123CD"
                  style="text-transform: uppercase;"
                  onkeyup="this.value = this.value.toUpperCase()">
              </div>

              <div class="form-group">
                <label for="modello">Modello *</label>
                <input 
                  type="text" 
                  id="modello" 
                  name="modello" 
                  required 
                  placeholder="ES: Fiat Ducato">
              </div>

              <div class="form-group">
                <label for="anno">Anno *</label>
                <input 
                  type="number" 
                  id="anno" 
                  name="anno" 
                  required 
                  min="1990" 
                  max="2030"
                  placeholder="ES: 2021">
              </div>
            </div>

            <button type="submit" class="btn btn-primary">
              Aggiungi Furgone
            </button>
          </form>
        </div>

        <!-- Lista Furgoni -->
        <div class="card">
          <h3>Lista Furgoni (<%= vehicles.length %>)</h3>
          
          <% if (vehicles.length === 0) { %>
            <p class="no-data">Nessun furgone presente. Aggiungi il primo!</p>
          <% } else { %>
            <div class="vehicle-grid">
              <% vehicles.forEach(vehicle => { %>
                <div class="vehicle-card <%= vehicle.status === 'assegnato' ? 'vehicle-assigned' : 'vehicle-available' %>">
                  <div style="display: flex; justify-content: space-between; align-items: start;">
                    <div style="flex: 1;">
                      <h4 style="margin: 0 0 0.5rem 0; color: #1e293b; font-size: 1.2rem;">
                        <%= vehicle.targa %>
                      </h4>
                      <p style="margin: 0 0 0.5rem 0; color: #64748b; font-size: 0.95rem;">
                        <strong><%= vehicle.modello %></strong> (<%= vehicle.anno %>)
                      </p>
                      
                      <% if (vehicle.status === 'assegnato') { %>
                        <div style="margin-top: 0.75rem; padding: 0.5rem; background: rgba(251, 191, 36, 0.1); border-radius: 6px; border-left: 3px solid #f59e0b;">
                          <p style="margin: 0; font-size: 0.85rem; color: #f59e0b; font-weight: 600;">
                            Assegnato
                          </p>
                        </div>
                      <% } else { %>
                        <div style="margin-top: 0.75rem; padding: 0.5rem; background: rgba(34, 197, 94, 0.1); border-radius: 6px; border-left: 3px solid #22c55e;">
                          <p style="margin: 0; font-size: 0.85rem; color: #22c55e; font-weight: 600;">
                            Disponibile
                          </p>
                        </div>
                      <% } %>
                    </div>

                    <% if (vehicle.status !== 'assegnato') { %>
                      <form 
                        action="/admin/vehicles/delete/<%= vehicle.id %>" 
                        method="POST" 
                        style="margin-left: 1rem;"
                        onsubmit="return confirm('Sei sicuro di voler eliminare questo veicolo?')">
                        <button 
                          type="submit" 
                          class="btn btn-danger btn-sm"
                          style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); padding: 0.5rem 0.75rem;">
                          Elimina
                        </button>
                      </form>
                    <% } %>
                  </div>
                </div>
              <% }) %>
            </div>

            <!-- Statistiche -->
            <div style="margin-top: 2rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
              <div style="padding: 1.5rem; background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); border-radius: 12px; color: white; text-align: center;">
                <div style="font-size: 2.5rem; font-weight: bold;"><%= vehicles.length %></div>
                <div style="font-size: 0.9rem; opacity: 0.9; margin-top: 0.5rem;">Totale Furgoni</div>
              </div>
              
              <div style="padding: 1.5rem; background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%); border-radius: 12px; color: white; text-align: center;">
                <div style="font-size: 2.5rem; font-weight: bold;">
                  <%= vehicles.filter(v => v.status === 'assegnato').length %>
                </div>
                <div style="font-size: 0.9rem; opacity: 0.9; margin-top: 0.5rem;">In Uso</div>
              </div>
              
              <div style="padding: 1.5rem; background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); border-radius: 12px; color: white; text-align: center;">
                <div style="font-size: 2.5rem; font-weight: bold;">
                  <%= vehicles.filter(v => v.status === 'disponibile').length %>
                </div>
                <div style="font-size: 0.9rem; opacity: 0.9; margin-top: 0.5rem;">Disponibili</div>
              </div>
            </div>
          <% } %>
        </div>

      </div>
    </main>
  </div>

  <script>
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      
      sidebar.classList.toggle('active');
      overlay.classList.toggle('active');
    }
  </script>
</body>
</html>
