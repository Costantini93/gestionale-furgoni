<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - Gestionale Furgoni</title>
  
  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#4CAF50">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ROBI Furgoni">
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" type="image/svg+xml" href="/images/icon.svg">
  <link rel="apple-touch-icon" href="/images/icon-192x192.png">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/premium.css">
  <link rel="stylesheet" href="/css/clean-theme.css">
  <style>
    body.login-page {
      background: white !important;
    }
    .login-box {
      background: white !important;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1) !important;
    }
    .login-box h1 {
      color: #22c55e !important;
      background: none !important;
      -webkit-text-fill-color: #22c55e !important;
      filter: none !important;
      text-shadow: none !important;
    }
    .password-wrapper {
      position: relative;
    }
    .password-toggle {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      user-select: none;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .password-toggle svg {
      width: 20px;
      height: 20px;
      fill: none;
      stroke: #000;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
    }
  </style>
</head>
<body class="login-page">
  <div class="login-container">
    <div class="login-box">
      <h1>Login</h1>
      
      <% if (error && error.length > 0) { %>
        <div class="alert alert-error">
          <%= error[0] %>
        </div>
      <% } %>
      
      <% if (success && success.length > 0) { %>
        <div class="alert alert-success">
          <%= success[0] %>
        </div>
      <% } %>

      <form action="/auth/login" method="POST">
        <div class="form-group">
          <label for="username">User Name</label>
          <input 
            type="text" 
            id="username" 
            name="username" 
            placeholder="MP Codes"
            required 
            autofocus
          >
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <div class="password-wrapper">
            <input 
              type="password" 
              id="password" 
              name="password" 
              placeholder="••••••••"
              required
              style="padding-right: 40px;"
            >
            <span class="password-toggle" onclick="togglePassword()" id="toggleIcon">
              <svg id="eyeIcon" viewBox="0 0 24 24">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
                <line id="eyeSlash" x1="1" y1="1" x2="23" y2="23" style="display: block;"></line>
              </svg>
            </span>
          </div>
        </div>

        <button type="submit" class="btn btn-primary btn-block">
          Login
        </button>
      </form>
    </div>
  </div>

  <script>
    function togglePassword() {
      const passwordInput = document.getElementById('password');
      const eyeSlash = document.getElementById('eyeSlash');
      
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        eyeSlash.style.display = 'none';
      } else {
        passwordInput.type = 'password';
        eyeSlash.style.display = 'block';
      }
    }
    
    // Register Service Worker for PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(registration => {
            console.log('✅ Service Worker registrato:', registration.scope);
          })
          .catch(error => {
            console.log('❌ Errore registrazione Service Worker:', error);
          });
      });
    }
  </script>
</body>
</html>
